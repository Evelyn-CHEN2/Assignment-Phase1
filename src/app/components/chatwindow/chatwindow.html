<div class="chat-window">
    <div class="chat-header">
      <div class="chan-info">
        <button type="button" class="back-btn" (click)="goBack()">
          <i class="bi bi-chevron-left"></i>
        </button>
        @if (currentUser?.avatar && currentUser) {
          <span class="avatar avatar--32">
            <img [src]="avatarSrcById[currentUser._id]" class="avatar-img" alt="avatar">
          </span>
        } @else {
          <span class="avatar avatar--32">
            <div class="avatar-img">{{ (currentUser?.username) | slice:0:1 | uppercase}}</div>
          </span>
        }
        <strong>{{ currentUser?.username }}</strong>
      </div>
      <h2 class="chan-name"># {{ channel?.channelname }}</h2>
      <p class="chan-sub">Online: {{userNum}}</p>
    </div>
  
    <!-- Messages display window-->
    <div class="chat-body" #scrollArea>
      <ul class="msg-list">
        @for (m of chatMessages; track $index) {
          <li class="msg" [class.is-mine]="m.sender === currentUser?._id">
            @if (isAdmin && currentUser?._id !== m.sender && !isSuperMap[m.sender] || (currentUser?.isSuper && currentUser?._id !== m.sender)) {
              <button
                class="btn btn-m p-0 msg-avatar"
                type="button"
                data-bs-toggle="modal"
                data-bs-target="#confirmBanModal"
                (click)="openBanModal(m.sender)">
                <span class="avatar avatar--28">
                  @if (avatarSrcById[m.sender]) {
                    <img [src]="avatarSrcById[m.sender]" alt="avatar" />
                  } @else {
                    {{ (userById[m.sender] ) | slice:0:1 | uppercase }}
                  }
                </span>
              </button>
            } @else {
              <span class="avatar avatar--28">
                @if (avatarSrcById[m.sender]) {
                  <img [src]="avatarSrcById[m.sender]" alt="avatar" />
                } @else {
                  {{ (userById[m.sender] ) | slice:0:1 | uppercase }}
                }
              </span>
            }
            <div class="msg-bubble">
              <div class="msg-text">{{ m.message }}</div>
            </div>
            <time class="msg-time" [attr.datetime]="m.timestamp">
              {{ m.timestamp | date: 'short' : 'Australia/Brisbane' }}
            </time>
          </li>
        }
        @if (errMsg) {
          <div class="alert text-danger" style="font-size: small; padding: 0">*{{ errMsg }}</div>
        }
      </ul>
    </div>
  
    <!-- Text input area -->
    <form class="chat-input" (ngSubmit)="sendMessage($event)">
      <input 
        class="form-control me-2" type="text" 
        [(ngModel)]="message" 
        name="message" 
        placeholder="Express your ideas ..." required/>
      <button class="send-btn" type="submit">Send</button>
    </form>
</div>

<!-- Ban user confirmation modal -->
<div class="modal fade" id="confirmBanModal" 
     tabindex="-1" 
     aria-labelledby="confirmBanLabel" 
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="confirmBanLabel">Are you sure to ban
          @if (selectedUser) {
              <strong>User: {{ userById[selectedUser] }}</strong>?
          }
        </p>
      </div>
      <div class="modal-footer py-2">
        <button 
          type="button" 
          class="btn btn-sm btn-outline-secondary" 
          data-bs-dismiss="modal">
          Cancel
        </button>
        <button 
          type="button" 
          class="btn btn-sm btn-danger" 
          (click)="selectedUser && confirmBan(selectedUser, channelId, $event)" 
          data-bs-dismiss="modal">
          Ban
        </button>
      </div>
    </div>
  </div>
</div>
  






