<div class="chat-window">
    <div class="chat-header">
      <div class="chan-info">
        <button type="button" class="back-btn" (click)="goBack()">
          <i class="bi bi-chevron-left"></i>
        </button>
        <div class="avatar">
            {{ (currentUser?.username) | slice:0:1 | uppercase }}
        </div>
        <strong>{{ currentUser?.username }}</strong>
      </div>
      <h2 class="chan-name"># {{ channel?.channelname }}</h2>
      <p class="chan-sub">Online: {{userNum}}</p>
    </div>
  
    <!-- Messages display window-->
    <div class="chat-body" #scrollArea>
      <ul class="msg-list">
        @for (m of chatMessages; track $index) {
          <li class="msg" [class.is-mine]="m.sender === currentUser?._id">
            <button
              class="btn btn-m p-0 msg-avatar" 
              style="color: #40916c; border: none;" 
              type="button"
              data-bs-toggle="modal" 
              data-bs-target="#confirmBanModal" 
              (click)="openBanModal(m.sender)">
              {{ (userById[m.sender]) || 'U'}}
            </button>
            <div class="msg-bubble">
              <div class="msg-text">{{ m.message }}</div>
            </div>
            <time class="msg-time" [attr.datatime]="m.timestamp">
              {{ m.timestamp | date: 'short' : 'Australia/Brisbane' }}
            </time>
          </li>
        }
        @if (errMsg) {
          <div class="alert text-danger" style="font-size: small; padding: 0">*{{ errMsg }}</div>
        }
      </ul>
    </div>
  
    <!-- Text input area -->
    <form class="chat-input" (ngSubmit)="sendMessage($event)">
      <input 
        class="form-control me-2" type="text" 
        [(ngModel)]="message" 
        name="message" 
        placeholder="Express your ideas ..." required/>
      <button class="send-btn" type="submit">Send</button>
    </form>
</div>

<!-- Ban user confirmation modal -->
<div class="modal fade" id="confirmBanModal" 
     tabindex="-1" 
     aria-labelledby="confirmBanLabel" 
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="confirmBanLabel">Are you sure to ban
          @if (selectedUser) {
              <strong>User: {{ userById[selectedUser] }}</strong>?
          }
        </p>
      </div>
      <div class="modal-footer py-2">
        <button 
          type="button" 
          class="btn btn-sm btn-outline-secondary" 
          data-bs-dismiss="modal">
          Cancel
        </button>
        <button 
          type="button" 
          class="btn btn-sm btn-danger" 
          (click)="selectedUser && confirmBan(selectedUser, channelId, $event)" 
          data-bs-dismiss="modal">
          Ban
        </button>
      </div>
    </div>
  </div>
</div>
  






