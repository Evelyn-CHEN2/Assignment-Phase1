<div class="account-card">
  <div class="account-header">
    @if (user?.avatar) {
      <img [src]="avatarSrc || user?.avatar" class="avatar-img" alt="avatar">
    } @else {
      <div class="avatar-img">{{ (user?.avatar || user?.username) }}</div>
    }
    

    <div class="user-main">
      <h2 class="account-title">{{ user?.username }}</h2>
      <p class="user-email">Email: {{ user?.email }}</p>
    </div>
   
    <div class="header-actions">
      <button 
        type="button" 
        class="roles-badge roles-badge--btn"
        data-bs-toggle="modal" data-bs-target="#changeProfileModal"
        (click)="openProfileModal(user!, $event)">
        <i class="bi bi-person-lines-fill"></i>
      </button>
      <span class="roles-badge" [attr.data-role]="userRole">
        {{ userRole }}
      </span>
      <!-- This button is used for user to remove the account self -->
        <button
          class="roles-badge roles-badge--btn" type="button"
          data-bs-toggle="modal" data-bs-target="#confirmDeleteModal"
          (click)="user && openDeleteModal(user)">
          Remove
        </button>
    </div>
  </div>

  <div class="account-section">
    <h3 class="section-title">Groups & Channels</h3>
    <ul class="group-list">
      @for (group of formattedGroups; track group._id) {
        <li class="group-item">
          <span class="group-chip">{{ group.groupname }}</span>
          <div class="channel-chips">
            @for (channel of group.channels; track channel._id) {
              <button 
                class="chip chip--btn" type="button" 
                (click)="joinChannel(channel)"
                [disabled]="banReport?.channelIds?.includes(channel._id)">
                {{ channel.channelname }}
                @if (banReport?.channelIds?.includes(channel._id)) {
                  <i class="bi bi-ban" style="color: #ef233c; font-size: small;"></i>
                }
              </button>
            }
          </div>
          <button 
            class="btn p-0 ms-auto" style="color: #ef233c" 
            type="button" 
            
            data-bs-toggle="modal" 
            data-bs-target="#confirmLeaveGroupModal"
            (click)="openLeaveGroupModal(group)">
            <i class="bi bi-box-arrow-right"></i>
          </button>
        </li>
      }
    </ul>
  </div>
</div>

<!-- Delete user confirmation modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-m">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="confirmDeleteLabel">
          Are you sure to delete your account permanently?
        </p>
        <small class="text-muted">This action cannot be undone.</small>
      </div>
      <div class="modal-footer py-2">
        <button 
          type="button" class="btn btn-sm btn-outline-secondary" 
          data-bs-dismiss="modal">
          Cancel
        </button>
        <button 
          type="button" class="btn btn-sm btn-danger" 
          data-bs-dismiss="modal" 
          (click)="user && confirmDeleteUser(user!, $event)"> <!-- user! is for check user is not null -->
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Leave group confirmation modal -->
<div class="modal fade" id="confirmLeaveGroupModal" tabindex="-1" aria-labelledby="confirmLeaveGroupLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="confirmLeaveGroupLabel">
          Are you sure to leave Group ?
        </p>
        @if (selectedGroup) {
          <strong>{{selectedGroup.groupname}}</strong>
        }
      </div>
      <div class="modal-footer py-2">
        <button 
          type="button" class="btn btn-sm btn-outline-secondary" 
          data-bs-dismiss="modal">
          Cancel
        </button>
        <button 
          type="button" class="btn btn-sm btn-danger" 
          data-bs-dismiss="modal" 
          (click)="selectedGroup && confirmLeaveGroup(selectedGroup, user!, $event)">  
          Leave
        </button>
      </div>
    </div>
  </div>
</div>

@if (errMsg) {
  <p class="text-danger mb-0" style="font-size: small;">*{{ errMsg }}</p>
}
       
<!-- Change user profile modal -->
<div class="modal fade" id="changeProfileModal" tabindex="-1" aria-labelledby="changeProfileLabel" aria-hidden="true">
  <div class="modal-dialog">
    @if(selectedUser) {
      <form class="modal-content" (ngSubmit)="saveEdit()">
        <div class="modal-header">
          <h5 class="modal-title">Edit Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>
            <div class="modal-body">     
                <div class="mb-3">
                  <input #fileInput type="file" accept="image/*" (change)="changeAvatar($event)">
                  <img [src]="avatarSrc" class="avatar-img">
                </div>
            </div>
  
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">
            Save
          </button>
        </div>
      </form>
    }
  </div>
</div>

  
