<div class="account-card">
  <div class="account-header">
    <div class="avatar">{{ (user?.username || '?') }}</div>

    <div class="user-main">
      <h2 class="account-title">{{ user?.username }}</h2>
      <p class="user-email">Email: {{ user?.email }}</p>
    </div>
   
    <div class="header-actions">
      <span class="roles-badge" [attr.data-role]="user?.role">
        {{ user?.role }}
      </span>
      <!-- This button is used for user to remove the account self -->
      @if (viewer?.id === user?.id) {
        <button
          class="roles-badge roles-badge--btn" type="button"
          data-bs-toggle="modal" data-bs-target="#confirmDeleteModal"
          (click)="user && openDeleteModal(user)">
          Remove
        </button>
      }
    </div>
  </div>

  <div class="account-section">
    <h3 class="section-title">Groups & Channels</h3>
    <ul class="group-list">
      @for (group of userGroups; track group.id) {
        <li class="group-item">
          <span class="group-chip">{{ group.groupname }}</span>
          <div class="channel-chips">
            @for (channel of group.channels; track channel.id) {
              <button 
                class="chip chip--btn" type="button" 
                (click)="joinChannel(channel)"
                [disabled]="viewer?.id !== user?.id">
                {{ channel.channelname }}
              </button>
            }
          </div>
          @if (viewer?.id === user?.id) {
            <button 
              class="btn p-0 ms-auto" style="color: #ef233c" type="button" 
              data-bs-toggle="modal" data-bs-target="#confirmLeaveGroupModal"
              (click)="openLeaveGroupModal(group)">
              <i class="bi bi-box-arrow-right"></i>
            </button>
          } @else {
            <button class="btn btn-sm p-0 ms-auto" style="color: #40916c;" type="button"
              (click)="toggleUpdateRole(group)">
              <i class="bi bi-pencil-square"></i>
            </button>
            {{roleByGroup[group.id]}}
          }
        </li>
        @if (showUpdateRole[group.id]) {
          <div class="update-role-pop mt-2 gap-2 d-flex align-items-center" >
              <select class="form-select flex-grow-1" [(ngModel)]="newRole[group.id]" name="newRole{{group.id}}">
                  <option value="chatuser">Chat User</option>
                  <option value="admin">Admin</option>
                  <option value="super">Super</option>
              </select>
              <button 
                class="roles-badge--sm roles-badge--btn roles-badge--grey" 
                type="button" 
                (click)="updateRole(user!, group)">
                Update
              </button>
          </div>
        }
      }
    </ul>
  </div>
</div>

<!-- Delete user confirmation modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-m">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="confirmDeleteLabel">Are you sure to delete your account permanently?</p>
        <small class="text-muted">This action cannot be undone.</small>
      </div>
      <div class="modal-footer py-2">
        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-sm btn-danger" data-bs-dismiss="modal" (click)="user && confirmDeleteUser(user!, $event)"> 
                                                                                                      <!-- user! is for check user is not null -->
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Leave group confirmation modal -->
<div class="modal fade" id="confirmLeaveGroupModal" tabindex="-1" aria-labelledby="confirmLeaveGroupLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="confirmLeaveGroupLabel">Are you sure to leave Group ?</p>
        @if (selectedGroup) {
          <strong>{{selectedGroup.groupname}}</strong>
        }
      </div>
      <div class="modal-footer py-2">
        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-sm btn-danger" data-bs-dismiss="modal" (click)="selectedGroup && confirmLeaveGroup(selectedGroup, user!, $event)">  
          Leave
        </button>
      </div>
    </div>
  </div>
</div>
        