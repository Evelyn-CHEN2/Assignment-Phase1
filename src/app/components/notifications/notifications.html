<ul class="notif-list p-0 m-0">
  @if (errMsg) {
    <div class="alert text-danger" style="font-size: small; padding: 0">*{{ errMsg }}</div>
  }
  @for (notification of notifications; track notification._id) {
    <li class="notif-card card shadow-sm mb-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start gap-3">
          <!-- Left: main info -->
          <div class="flex-grow-1">
            <div class="notif-title mb-1">
              <i class="bi bi-bell me-2"></i>
              Group: {{ groupById[notification.groupToApply] }}
              <span class="status-pill text-capitalize me-2"
                  [ngClass]="notification.status">
              {{ notification.status }}
              </span>
            </div>

            <div class="notif-meta text-secondary">
              <span class="meta">
                <i class="bi bi-clock me-1"></i>
                Applied at: {{ notification._id | date: 'short' :'Australia/Brisbane' }}
              </span>
              <span class="dot mx-2">•</span>
              <span class="meta">
                <i class="bi bi-person me-1"></i>
                Applier: {{ userById[notification.applier] }}
              </span>
              
                @if (notification.approvedBy) {
                  <span class="dot mx-2">•</span>
                  By: {{ userById[notification.approvedBy]}}
                }
            </div>
          </div>

          <div class="notif-actions text-end">
            <div class="btn-group">
              <button 
                type="button"
                class="btn btn-approve btn-sm"
                data-bs-toggle="modal" 
                data-bs-target="#approveApplicationModal" 
                [disabled]="notification.status === 'approved'"
                (click)="openApproveModal(notification)">
                <i class="bi bi-check2-circle me-1"></i>Approve
              </button>
              <button 
                type="button"
                class="btn btn-delete btn-sm"
                data-bs-toggle="modal" 
                data-bs-target="#deleteApplicationModal" 
                (click)="openDeleteModal(notification)">
                <i class="bi bi-trash3 me-1"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </li>
    <!-- Approve application modals -->
    <div class="modal fade" id="approveApplicationModal" tabindex="-1" aria-labelledby="approveApplicationLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
          <div class="modal-body py-3">
            <p class="mb-0" id="approveApplicationLabel">
              Are you sure you want to approve
                @if (selectedNotification) {
                  <strong>{{ userById[notification.applier]}}'s application?</strong>
                }
            </p>
          </div>
          <div class="modal-footer py-2">
            <button 
              type="button" class="btn btn-sm btn-outline-secondary" 
              data-bs-dismiss="modal">
              Cancel
            </button>
            <button 
              type="button" class="btn btn-sm btn-danger" 
              data-bs-dismiss="modal"
              (click)="selectedNotification && approve(selectedNotification, $event)">
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</ul>

<!-- Delete application modals  -->
<div class="modal fade" id="deleteApplicationModal" tabindex="-1" aria-labelledby="deleteApplicationLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="deleteApplicationLabel">
          Are you sure you want to delete this?
        </p>
      </div>
      <div class="modal-footer py-2">
        <button 
          type="button" class="btn btn-sm btn-outline-secondary" 
          data-bs-dismiss="modal">
          Cancel
        </button>
        <button 
          type="button" class="btn btn-sm btn-danger" 
          (click)="selectedNotification && delete(selectedNotification, $event)" 
          data-bs-dismiss="modal">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
<hr>

<!-- Display banned users -->
@if (userRole === 'super') {
  <div class="banned-list card p-3">
    <div class="d-flex align-items-center mb-2">
      <i class="bi bi-person-fill-lock me-2 text-danger"></i>
      <h6 class="mb-0">Banned users</h6>
      <span class="ms-2 badge rounded-pill text-bg-danger">
        {{ bannedUsers.length || 0 }}
      </span>
    </div>

    @if (bannedUsers.length) {
      <ul class="list-unstyled mb-0">
        @for (bannedUser of bannedUsers; track bannedUser._id) {
          <li class="banned-item d-flex align-items-center gap-3 p-2 mb-2 border rounded-3">
            <div class="avatar bg-danger-subtle text-danger fw-semibold">
              {{ bannedUser.username | slice:0:1 | uppercase }}
            </div>
            <div class="flex-grow-1">
              <div class="fw-semibold">
                {{ bannedUser.username }}
                <span class="badge text-bg-danger ms-2">Banned</span>
              </div>
              <div class="text-muted small">Email: {{ bannedUser.email }}</div>
            </div>
            <!-- Unban the user -->
            <button 
              class="btn btn-sm btn-outline-danger" 
              data-bs-toggle="modal" 
              data-bs-target="#confirmUnbanModal" 
              (click)="openUnbanModal(bannedUser)">
              Unban
            </button>
          </li>
        }
      </ul>
    } @else {
      <div class="text-muted small">No banned users...</div>
    }
  </div>
}

<!-- Confirm to unban user -->
<div class="modal fade" id="confirmUnbanModal" tabindex="-1" aria-labelledby="confirmUnbanLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-body py-3">
        <p class="mb-0" id="confirmUnbanLabel">
          Are you sure you want to release user 
            <strong>{{ bannedUser?.username }}</strong>?
        </p>
      </div>
      <div class="modal-footer py-2">
        <button 
          type="button" class="btn btn-sm btn-outline-secondary" 
          data-bs-dismiss="modal">
          Cancel
        </button>
        <button 
          type="button" class="btn btn-sm btn-danger" 
          (click)="bannedUser && unBan(bannedUser, $event)" 
          data-bs-dismiss="modal">
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>
